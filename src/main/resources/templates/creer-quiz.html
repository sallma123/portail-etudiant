<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Cr√©er un quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(to right, #667eea, #764ba2);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding-top: 2rem;
            font-family: 'Segoe UI', sans-serif;
        }
        .card {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 800px;
        }
    </style>
</head>
<body>

<div class="card">
    <h3 class="text-center mb-4">üìù Cr√©er un quiz</h3>

    <!-- ‚úÖ Message de confirmation -->
    <div th:if="${message}" class="alert alert-success text-center" th:text="${message}">Question enregistr√©e !</div>

    <!-- üéØ Cr√©ation du quiz (titre/seuil) -->
    <form th:if="${quiz == null}"
          th:action="@{'/enseignant/cours/' + ${cours.id} + '/enregistrer-quiz'}"
          method="post">
        <div class="row mb-3">
            <div class="col-md-8">
                <label>Titre du quiz</label>
                <input type="text" name="titre" class="form-control" placeholder="Ex: Quiz POO" required />
            </div>
            <div class="col-md-4">
                <label>Seuil (%)</label>
                <input type="number" name="seuil" class="form-control" placeholder="Ex: 60%" min="0" max="100" required />
            </div>
        </div>

        <div class="text-end">
            <button type="submit" class="btn btn-primary">‚úÖ Enregistrer</button>
        </div>
    </form>

    <!-- üéØ Ajout de questions -->
    <form th:if="${quiz != null}" method="post">

        <!-- Titre et seuil -->
        <div class="row mb-3">
            <div class="col-md-8">
                <label>Titre du quiz</label>
                <input type="text" name="titre" class="form-control" th:value="${quiz.titre}" required />
            </div>
            <div class="col-md-4">
                <label>Seuil (%)</label>
                <input type="number" name="seuil" class="form-control" th:value="${quiz.seuil}" min="0" max="100" required />
            </div>
        </div>

        <!-- Question -->
        <div class="mb-3">
            <label>Question</label>
            <input type="text" name="question" class="form-control" placeholder="Votre question" required />
        </div>

        <!-- Choix -->
        <div id="choix-container">
            <div class="d-flex align-items-center mb-2">
                <input type="text" name="choix" class="form-control me-3" placeholder="Choix 1" required />
                <input type="checkbox" name="corrects" value="1" />
            </div>
            <div class="d-flex align-items-center mb-2">
                <input type="text" name="choix" class="form-control me-3" placeholder="Choix 2" required />
                <input type="checkbox" name="corrects" value="2" />
            </div>
        </div>

        <!-- Ajouter/Supprimer choix -->
        <div class="d-flex justify-content-between my-3">
            <button type="button" class="btn btn-outline-primary" onclick="ajouterChoix()">+ Ajouter un choix</button>
            <button type="button" class="btn btn-outline-danger" onclick="supprimerChoix()">Supprimer le dernier</button>
        </div>

        <!-- Boutons -->
        <div class="d-flex justify-content-between">
            <!-- Ajouter question (reste sur la page) -->
            <button type="submit" class="btn btn-outline-success"
                    formaction="#"
                    th:formaction="@{'/enseignant/quiz/' + ${quiz.id} + '/ajouter-question'}">
                ‚ûï Ajouter question
            </button>

            <!-- Enregistrer et retourner -->
            <button type="submit" class="btn btn-outline-secondary"
                    formaction="#"
                    th:formaction="@{'/enseignant/quiz/' + ${quiz.id} + '/ajouter-question?redirect=mes-cours'}">
                ‚úÖ Enregistrer
            </button>
        </div>
    </form>
</div>

<script>
    let index = 2;

    function ajouterChoix() {
        index++;
        const container = document.getElementById("choix-container");
        const div = document.createElement("div");
        div.className = "d-flex align-items-center mb-2";
        div.innerHTML = `
            <input type="text" name="choix" class="form-control me-3" placeholder="Choix ${index}" required />
            <input type="checkbox" name="corrects" value="${index}" />
        `;
        container.appendChild(div);
    }

    function supprimerChoix() {
        const container = document.getElementById("choix-container");
        if (container.children.length > 2) {
            container.removeChild(container.lastElementChild);
            index--;
        }
    }
</script>

</body>
</html>
